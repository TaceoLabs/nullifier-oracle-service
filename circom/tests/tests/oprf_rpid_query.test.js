const { wasm } = require("circom_tester");
const { expect } = require("chai");
const path = require("path");

describe("Oprf RpID Query (d=10)", function () {
  this.timeout(10000);

  let circuit;
  before(async () => {
    circuit = await wasm(
      path.join(__dirname, "circuits/oprf_rpid_query_test.circom"),
      { include: [path.join(__dirname, "../../")] },
    );
    await circuit.loadConstraints();
  });


  it("kat0 success", async () => {
    const witness = await circuit.calculateWitness({pk: [
      [9754297836289164639697714023295793933307266984224996490695241473694798792974n, 12325719311766533317659470690816452843027479249997696994237741503542103971692n],
      [2058036243875102027232102044836704317858003135895586179195179925284882161420n, 13777152149169807932364000299606587274850318818647690724804079964822607474341n],
      [12926335063978273448089741990924527827340544719094547009383816569581332416077n, 13601884821482902342518099314271713773927626584774316227795436923954815979717n],
      [15890362104147414236481099707146820026526028261809464870332667742088044753295n, 9305849029698419683461715435057289643087564957473511777314162422607954425484n],
      [13303572542792918002884980880813813438951125505225281868698392274846741639051n, 14281648449514879127657177283065956657207789389634959451245749004254654346433n],
      [8048422692917407357754569564324944749131654823460955589969894860664656700621n, 9310586684431318912034216906537211105451175489318701082434046368214793410626n],
      [18516130930603103222343674585761449081671677977003354333888959558986355406385n, 14628095328363834120302165234669936941620104552344831155901863449463027807632n]
    ],
    pk_index: 2n,
    s: 2544387773287713608734053405710230027108065671613489570302509455663116748904n,
    r: [3363845127626689743447861014633683878652853187568940761599433063083784220412n, 17543538083054083877587720748168586213072456776118263501603064733823857716461n],
    cred_type_id: 2236132571319938347910518696643047589185681298608183023074417259533825907089n,
    cred_pk: [10383962338810605970677834770006252870070897476863174628945286257941298550540n, 10830305451875640760532766074012210775601766211022045703458366357928759137180n],
    cred_hashes: [4524156667454087876740248043912532392117325383065164340518401460606699527741n, 13977834369929188974757768747349799868191471529117526579503803036696137904793n],
    cred_genesis_issued_at: 14632006024712501929n,
    cred_expires_at: 3739555510988797555n,
    cred_s: 382608383362792695939880490721827571589900497060023540155895555609664007252n,
    cred_r: [19113388987334225276271655520607763288311910628770795980364447234631824363980n, 1722280498179047814923629828772521301859124020139470396973817055228578268311n],
    current_time_stamp: 361890468729367888n,
    merkle_root: 17906942847304464863006628239816675928164475725108906894917742712995042388663n,
    depth: 10n,
    mt_index: 619n,
    siblings: [
      14543781253279221655341348046093482030359842858497268799758461103786468968520n,
      11645641403676661130561889787211885818940845317622158566969546584908643962625n,
      585667135721753969363509939300211011246556245223812717046690099385593273174n,
      13831276848914456433029944485688452931943276765267741191127219913539274952909n,
      15123163260382119529154699958310842429671386656986509951998058885724184625211n,
      3698702788246529553998844916267818368435299657182417440867583687256534559455n,
      15009307841198748046734354117872496801061930613634362932433916018409464931320n,
      17755219582132495894705533450858798905341479365658436522558995884914908206475n,
      4510870697710898789031470398971957650637843318989665041899201573351849687225n,
      13728601500714660164204724228361781808217876930452909341427924627120091660145n
    ],
    beta: 627417214015857646006077960116349181056883819668863069919130865130718843844n,
    nonce: 18563106531117877420227217768313219997461291569855702387772872703620311217590n}, true);
 await circuit.assertOut(witness, {
    q: [14520554312294361209591663005069563124311121369157694971243734076549762704148n, 652100795925002626337909443870407545254814810754569171809785808095481469545n]
    });
    await circuit.checkConstraints(witness);
  });
});
