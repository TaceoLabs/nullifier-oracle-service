const { wasm } = require("circom_tester");
const { expect } = require("chai");
const path = require("path");

describe("Oprf Delegate (d=10)", function () {
  this.timeout(10000);

  let circuit;
  before(async () => {
    circuit = await wasm(
      path.join(__dirname, "circuits/oprf_delegate_test.circom"),
      { include: [path.join(__dirname, "../../")] },
    );
    await circuit.loadConstraints();
  });


  it("kat0 success", async () => {
    const witness = await circuit.calculateWitness({user_pk: [
      [17539425622894167585028705807189604841219658715978314229986157033386943743786n, 8949426678447847175507114481994687452650829748214658864733591600658784663296n],
      [21347893065152992451727191784755228704195184048116596472181109657176812740376n, 6427701353590312903997954369537264796249443466788657984032954707682950017523n],
      [16587394522621530447775685523049077392886595762331296499618176365055102942426n, 5007893086862883265802127039142242607118440040984595395008713446165332640932n],
      [142111215835770646712414336013344173971128298228101131984672765701482170164n, 4380538414601652211461681807691082887745733260333838300671866136201054222602n],
      [9926777520714573965638935060826292196004675693827465600734841770005949863664n, 12601188366880036412278479819210955223891286768406448807748946107348775194901n],
      [20257269962385175836154233913297509055640769189473284082299322871656215308714n, 6003927827687713027920961571383907299978204805922900139571805914458913881018n],
      [16829964214544869689261971192278421603965715336401560932134599096228106006573n, 11824941487663744369610204742681050443465163064854262039464049435845578285576n]
    ],
    pk_index: 3n,
    query_s: 692359504600507514379328551390132770805552673156706063003994787838335216987n,
    query_r: [10935627389897453615401993283578742447585648447509485912135338502553373340652n, 17860790671452555874284843274918793777620080319285822479402815719351971127492n],
    merkle_root: 17413003936686925333813742522578973410717719301487766663451430077884536125555n,
    mt_index: 225n,
    siblings: [
      20145126631288986191570215910609245868393488219191944478236366445844375250869n,
      2455121972286674808869549714152349714206223604801818052723209294346684187305n,
      2688031480679618212356923224156338490442801298151486387374558740281106332049n,
      7260841701659063892287181594885047103826520447399840357432646043820090985850n,
      14264624174809365056092456028844144694862933637425998608510571382453050421969n,
      13367077320550519630911999863418302042067856699006993825537974968356422427445n,
      214678903408678002486556122306789455922347049616774171062257264890580087799n,
      8934255931615292796207589698979440249098767000376487422715387033237910160589n,
      11604210794019133877686484832610564879317509644833182169281087512926329127461n,
      18547636267779519404018917934516077568632802541582936154567712725787384033262n
    ],
    beta: 512360341584825494080971930517674581129767019104491998630251188731842558874n,
    dlog_e: 383355233440267391779647733538333605389010944859333571221381101946170690826n,
    dlog_s: 1489460510372339660697244372316121742735800134962432408154741201213700037543n,
    oprf_pk: [18583516951849911137589213560287888058904264954447406129266479391375859118187n, 11275976660222343476638781203652591255100967707193496820837437013048598741240n],
    oprf_response_blinded: [3985696557111347336681657562231209571339347100243910215073751891829609354610n, 9923778979711970663068491552201077972848120107376381326409530715238802158895n],
    oprf_response: [2433604529041261164486935273531691245856018714945774422518050899946367785271n, 2570793009618561818100168345531109268127332118778341373407966737578224905926n],
    nonce: 19413146054045297973885649588025613966856301528813738125853514129595782428910n,
    id_commitment_r: 18871704932868136054793192224838481843477328152662874950971209340503970202849n,
    encryption_sk: 1845266097319643908802818370170911164293680300997019730044553666779533165776n,
    mpc_public_keys: [
      [8374264022521132711781741456412929244803501110716064894973909683680234846943n, 17468463602721731953017895056766938800532460269618130649338880911788594695529n],
      [13610353140275889700040119751915617172687993581229729087437657393143052873716n, 5399747220458290938972943111172614602560248888338834186116162316588903503640n],
      [18456852911164158042139128461381208958408113247540181466659142697577196551562n, 7494149510479008607718015602827050755683266261952197454266553891126690772262n]
    ],
    rp_merkle_root: 7008989469364679076295557201520434017243009115204435822766059384795081690847n,
    rp_mt_index: 334n,
    rp_siblings: [
      4176855770021968762089114227379105743389356785527273444730337538746178730938n,
      16310982107959235351382361510657637894710848030823462990603022631860057699843n,
      3605361703005876910845017810180860777095882632272347991398864562553165819321n,
      19777773459105034061589927242511302473997443043058374558550458005274075309994n,
      7293248160986222168965084119404459569735731899027826201489495443245472176528n,
      4950945325831326745155992396913255083324808803561643578786617403587808899194n,
      9839041341834787608930465148119275825945818559056168815074113488941919676716n,
      18716810854540448013587059061540937583451478778654994813500795320518848130388n,
      8489481874657167625850402416022768218935811957398944701892791078040199225319n,
      13366227751236448055703219624443766518486274913732869981435105211514511486376n
    ],
    map_id_share: [
      7072354584330803739893341075959600662170009672799717087821974214692377537543n,
      17885221558895888060441738558710283599239203102366021944096727770820448633434n,
      18818909600451858644157731855844665915687516025666329655477706387638790820591n
    ],
    r_share: [
      13721691983499918028351090247414996537303665840643865831659579087433220869394n,
      10504527072856625374251918935304995810363256944839645422147112326469942932346n,
      9922136640310746679589505888952316195107449577468486901753282935448033947801n
    ],
    expiration: 19515264307125146297792905993864830562548050510809169375491859162741845474966n}, true);
 await circuit.assertOut(witness, {
    id_commitment: 9529767258191211960817313042611088032520010635337651347924666109510301895775n,
    map_id_commitment: 6688646652800461145401205186446066451608319002312655281797764492827786296681n,
    encryption_pk: [1870943925490415367247887703275024688651561144872653820895754064460650035354n, 21149104454264069989476496661807851228661229710566313174512759231778706562047n],
    ciphertexts: [
      [2816942548333186237519562678907375669663536263141419181997313448985809453158n, 13747213903327143304108434378647696505626756252110563563363178631952243808169n, 16109418215257863515275365942558303356423296114782533255727503935469619925950n, 1759359346415626703489108456699609645776855265984475127526329830789778296361n],
      [6276244935766131627043550278561807876454269658273953238119105146099351873537n, 783871050122855345109430211059609738109978745336909112291881550988740382625n, 13700626220491125938119404987790665699484044036943118967494526850990652229043n, 18432437182266167825820046220388637055124073544871395741542107237236430249170n],
      [9990010952644935883205432572586824105382659922412670857207540763571192141467n, 4161340241220629515023675028625924855435199038326000869328034304940417595231n, 15990594184618874769478544830895989543341815570245633642734075029372937480755n, 934430977260190421370669322010022222147604039541704029728146524232054425739n]
    ]
    });
    await circuit.checkConstraints(witness);
  });
});
