const { wasm } = require("circom_tester");
const { expect } = require("chai");
const path = require("path");

describe("Oprf Query (d=10)", function () {
  this.timeout(10000);

  let circuit;
  before(async () => {
    circuit = await wasm(
      path.join(__dirname, "circuits/oprf_query_test.circom"),
      { include: [path.join(__dirname, "../../")] },
    );
    await circuit.loadConstraints();
  });


  it("kat0 success", async () => {
    const witness = await circuit.calculateWitness({pk: [
      [18022186567988718176049327160312383579645520043473410664917085192987889807000n, 15803720108247221524119424295841210687464417558416089096094933584671999610512n],
      [3625457205105977300880046969451474103929860078530036204365035450988066154268n, 8128562558872368035142296719302663527236834184483066311699225257287845129828n],
      [12926335063978273448089741990924527827340544719094547009383816569581332416077n, 13601884821482902342518099314271713773927626584774316227795436923954815979717n],
      [13772782017119817504626528288537645329324911618969260780049818528615152436320n, 20651156072385925962375579854734757291786189916262559671946809645352474742915n],
      [20834315740084454812412944601257107479465381231220045024647740359544767628560n, 9755605384519302784765769836936566011883312930367047823394770112488229331445n],
      [17559372006301968164167998798539428663841028236560844122790168713286941856466n, 4316104294779529964712702508278438496609088028544110266136441199522648722635n],
      [21156954722999275898290003515926840065873148855607139418772450326971123009065n, 8071850774315653870726838555454195935201972529490453595143432366322581397905n]
    ],
    pk_index: 2n,
    s: 2080301121643018532793785732095776935429541059592256057340704691377997312039n,
    r: [21561604489375439305242200544911677044098492674406238755491271981380184733940n, 5075287832405450193696137447979478944619632217274769163837508212029830763331n],
    merkle_root: 2697483548244784321544879549473854204019958976851518587166295439154135086417n,
    mt_index: 619n,
    siblings: [
      585667135721753969363509939300211011246556245223812717046690099385593273174n,
      13831276848914456433029944485688452931943276765267741191127219913539274952909n,
      15123163260382119529154699958310842429671386656986509951998058885724184625211n,
      3698702788246529553998844916267818368435299657182417440867583687256534559455n,
      15009307841198748046734354117872496801061930613634362932433916018409464931320n,
      17755219582132495894705533450858798905341479365658436522558995884914908206475n,
      4510870697710898789031470398971957650637843318989665041899201573351849687225n,
      13728601500714660164204724228361781808217876930452909341427924627120091660145n,
      367163834445130469708330074562703722303807574404567970933209548626671695554n,
      10749291063558121804414082224321566190292085012775435926940002682854965857323n
    ],
    beta: 660976821447400704848384444919638339860581335886782814636236627478877642125n,
    rp_id: 14543781253279221655341348046093482030359842858497268799758461103786468968520n,
    action: 11645641403676661130561889787211885818940845317622158566969546584908643962625n}, true);
 await circuit.assertOut(witness, {
    q: [9330146831248769614633765095253195947028002517843626966266981373027155217365n, 5601628329095185688703662085490217796259720338699834705307290963524551090507n]
    });
    await circuit.checkConstraints(witness);
  });
});
