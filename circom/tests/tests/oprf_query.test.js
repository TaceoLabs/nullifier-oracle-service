const { wasm } = require("circom_tester");
const { expect } = require("chai");
const path = require("path");

describe("Oprf Query (d=10)", function () {
  this.timeout(10000);

  let circuit;
  before(async () => {
    circuit = await wasm(
      path.join(__dirname, "circuits/oprf_query_test.circom"),
      { include: [path.join(__dirname, "../../")] },
    );
    await circuit.loadConstraints();
  });


  it("kat0 success", async () => {
    const witness = await circuit.calculateWitness({nonce: 18871704932868136054793192224838481843477328152662874950971209340503970202849n,
    pk: [12926335063978273448089741990924527827340544719094547009383816569581332416077n, 13601884821482902342518099314271713773927626584774316227795436923954815979717n],
    s: 1428704976040692787563766458108667460514033183087153782403228241380565120095n,
    r: [17651964437045225240642814498401744805595732384394790240196200621545577912656n, 7547478996426738888523499356030555315488067211315061408640433654235675750539n],
    merkle_root: 12727797113624481662968589915748873527557072689506379814365429940239469478814n,
    index: 653n,
    siblings: [
      2276692615654762296369062350791857143858540739447513461287617473804955103126n,
      13721691983499918028351090247414996537303665840643865831659579087433220869394n,
      10504527072856625374251918935304995810363256944839645422147112326469942932346n,
      9922136640310746679589505888952316195107449577468486901753282935448033947801n,
      7072354584330803739893341075959600662170009672799717087821974214692377537543n,
      17885221558895888060441738558710283599239203102366021944096727770820448633434n,
      4176855770021968762089114227379105743389356785527273444730337538746178730938n,
      16310982107959235351382361510657637894710848030823462990603022631860057699843n,
      3605361703005876910845017810180860777095882632272347991398864562553165819321n,
      19777773459105034061589927242511302473997443043058374558550458005274075309994n
    ],
    beta: 1229480072495577306800228020644366805423157777295430051907138677321452514450n}, true);
 await circuit.assertOut(witness, {
     q: [3361355416507432587001463563518097986132233930004197534129518586384452713864n, 20809189209105382633051228602747759813166925789775204022512505555497489416700n]
    });
    await circuit.checkConstraints(witness);
  });
});
