//! Secret manager interface for OPRF nodes.
//!
//! This module defines the [`SecretManager`] trait, which is used to
//! persist and retrieve `OprfKeyMaterial`.
//!
//! Current `SecretManager` implementations:
//! - AWS (cloud storage)

use std::sync::Arc;

use async_trait::async_trait;
use oprf_types::{OprfKeyId, crypto::OprfKeyMaterial};

use crate::services::oprf_key_material_store::OprfKeyMaterialStore;

pub mod aws;

/// Dynamic trait object for secret manager service.
///
/// Must be `Send + Sync` to work with async contexts (e.g., Axum).
pub type SecretManagerService = Arc<dyn SecretManager + Send + Sync>;

/// Trait that implementations of secret managers must provide.
///
/// Handles persistence of `OprfKeyMaterial`.
#[async_trait]
pub trait SecretManager {
    /// Loads the DLog secrets and creates a [`OprfKeyMaterialStore`].
    async fn load_secrets(&self) -> eyre::Result<OprfKeyMaterialStore>;

    /// Retrieves the [`OprfKeyMaterial`] for the given [`OprfKeyId`].
    async fn get_oprf_key_material(&self, oprf_key_id: OprfKeyId) -> eyre::Result<OprfKeyMaterial>;
}
